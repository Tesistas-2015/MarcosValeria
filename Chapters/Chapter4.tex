% Chapter Template

\chapter{Resultados} % Main chapter title

En este cap\'itulo  describiremos los datos utilizados en 	nuestros experimentos, las m\'etricas de calidad utilizadas para evaluar los resultados, la manera en la que se  utilizaron los datos y los resultados obtenidos.\\

En la secci\'on  4.1 se describen los materiales utilizados para la realizaci\'on de este trabajo final. Los tipos de dataset utilizados con las caracter\'isticas correspondientes a cada tipo de im\'agenes, dispositivos de captura, resoluci\'on de las im\'agenes, entre otras.\\

En la secci\'on 4.2  se estudian las m\'etricas de calidad utilizadas..\\

En la secci\'on 4.3 se exponen los resultados obtenidos durante el dise\'no del algoritmo..\\

En la secci\'on 4.3.1 se exponen y analizan los resultados obtenidos durante la etapa de preprocesamiento. \\

En la secci\'on 4.3.2 ..\\

En la secci\'on 4.3.3 ..\\

En la secci\'on 4.4 ..\\

En la secci\'on 4.5 ..\\



\label{Chapter4} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}

%----------------------------------------------------------------------------------------
%	SECTION 1
%----------------------------------------------------------------------------------------

\section{Materiales}

Para la realizaci\'on de este trabajo final se utilizaron 3 bases de datos con im\'agenes de fondo de ojo, DRIVE, HRF, ARIA.\\

DRIVE es una base de datos a disposici\'on del p\'ublico, que consta de un total de 40 im\'agenes a color con diferentes lesiones. Las fotograf\'ias se obtuvieron a partir de un programa de cribado de la retinopat\'ia diab\'etica en los Pa\'ises Bajos. La poblaci\'on de selecci\'on consisti\'o en 453 sujetos de entre 31 y 86 a\~nos de edad. Cada imagen se ha comprimido JPEG, lo cual es una pr\'actica com\'un en los programas de cribado. De las 40 im\'agenes en la base de datos, 7 contienen la patolog\'ia, es decir, los exudados, hemorragias y cambios del epitelio pigmentario. Ver (\ref{fig:Drive_images_retinal}) para un ejemplo de una imagen patológica y una normal. Las im\'agenes fueron adquiridas mediante una c\'amara no midriática de 3 CCD Canon CR5 con un campo de $45^{\circ}$ de visi\'on (FOV). Cada i\'agen es capturada utilizando 8 bits por plano de color a 768 {x} 584 p\'ixeles. El FOV de cada imagen es circular con un di\'ametro de aproximadamente 540 p\'ixeles. El conjunto de 40 im\'agenes se dividi\'o en un conjunto de prueba y entrenamiento, ambos contienen 20 im\'agenes. Tres observadores, el primer y segundo autor y un estudiante de inform\\'atica segmentaron manualmente un n\'umero de im\'agenes. Todos los observadores fueron entrenados por un oftalm\'ologo con experiencia. El primer observador segment\'o 14 im\'agenes del conjunto de entrenamiento, mientras que el segundo observador segment\'o las otros 6 im\'agenes. El equipo de prueba fue segmentado en dos ocasiones resultando en un conjunto X e Y. El conjunto X fue segmentado tant por el primer y segundo observador (13 y 7 im\'agenes, respectivamente), mientras el conjunto Y se segmentó por completo por el tercer observador. El rendimiento de los algoritmos de segmentaci\'o de los vasos se midi\'o en la prueba. En el conjunto X los observadores marcaron 577,649 p\'ixeles como vasos y 3.960.494 como fondo (recipiente de 12,7\%). En el conjunto Y 556,532 p\'ixeles se marcaron como vasos y 3.981.611 como fondo (recipiente de 12,3\%).\\


\begin{figure}[H]
	{
	\centering
	\includegraphics[width=1\textwidth]{Figures/Drive_images_retinal}
	\caption[Drive]{Im\'agen de la retina - DRIVE: (a) Retina saludable, (b) Retina con muestras patol\'ogicas.}
	\label{fig:Drive_images_retinal}
	}
\end{figure}	


HRF es una base de datos que ha sido establecida por un grupo de investigaci\'on sobre el reconocimiento de patrones, en un proyecto llevado a cabo por el laboratorio de la Universidad de Erlangen-Nuremberg Alemania  en cooperación con  la Clínica de Oftalmología Tomas de Kubena, Zlin, República Checa, para apoyar los estudios comparativos sobre los algoritmos de segmentaci\'on autom\'atica de im\'agenes en la retina del fondo del ojo. Es una base de datos a disposici\'on del p\'ublico, que contiene en este momento 15 im\'agenes de pacientes sanos, 15 im\'agenes de pacientes con retinopat\'ia diab\'etica y 15 im\'agenes de pacientes con glaucoma. Las im\'agenes segmentadas de los vasos est\'an disponibles para cada imagen. Tambi\'en se proporcionan las m\'ascaras, se determina el campo de visi\'on (FOV) para los conjuntos de datos particulares. Los datos est\'adar de oro son generados por un grupo de expertos que trabajan en el campo de an\'alisis de im\'agenes de la retina y los m\'edicos de las cl\'inicas oftalmol\'ogicas. Las im\'agenes se capturaron usando una c\'amara  Canon EOS-20D con un campo de visi\'on de $60^{\circ}$ FOV. 
El tama\~no de las im\'agenes es de 3504 {x} 2336 p\'ixeles. Todas las im\'agenes son de 24 bits por p\'ixel y son almacenada en formato JPEG.Se proporciona tambien para cada imagen, una máscara binaria para determinar el campo de visi\'on. \cite{budai2011public} \\

\begin{figure}[H]
\centering
\graphicspath {Figures} 
	  \label{fig:color}}
		\subfloat{\includegraphics[width=0.3\textwidth]{01_dr.jpg} \label{fig:retinopatia}}
		\subfloat{\includegraphics[width=0.3\textwidth]{01_g.jpg} \label{fig:glaucoma}}
		\subfloat{\includegraphics[width=0.3\textwidth]{01_h.jpg} \label{fig:sana}}
    \caption{Im\'agenes del dataset HRF. De izquierda a derecha: Retinopat\'ia  diabetica; Glaucoma; Imagen Sana}
		\label{fig:transferOverfeat}
\end{figure}

ARIA es una base de datos creada en 2006, en una colaboración de investigación entre  St. Paul's Eye Unit, Royal Liverpool University Hospital Trust, Liverpool, Reino Unido y el Departamento de Oftalmología, Ciencias Clínicas, Universidad de Liverpool, Liverpool, Reino Unido \cite{}. La base de datos consta de tres grupos; uno tiene 92 im\'agenes con degeneraci\'on macular relacionada con la edad, el segundo grupo tiene 59 im\'agenes con diabetes y un grupo de control se compone de 61 im\'agenes. El rastro de los vasos sangu\'ineos, la ubicaci\'on del disco \'optico y la f\'ovea est\'a marcada por dos expertos en an\'alisis de imagen como patr\'on de referencia. Las im\'agenes se capturan a una resoluci\'on de 768 {x} 576 p\'ixeles de colores RGB con 8 bits por plano de color con una c\'amara de fondo Zeiss FF450 con un campo de visi\'on de $50^{\circ}$ y se almacenan como archivos TIFF sin comprimir.\\

\begin{figure}[H]
\centering
\graphicspath {Figures} 
	  \label{fig:color}}
		\subfloat{\includegraphics[width=0.3\textwidth]{a_01.png} \label{fig:a_}}
		\subfloat{\includegraphics[width=0.3\textwidth]{c_1_7.png} \label{fig:c_}}
		\subfloat{\includegraphics[width=0.3\textwidth]{d_1_19.png} \label{fig:d_}}
    \caption{Im\'agenes del dataset ARIA. De izquierda a derecha: a; c; d}
		\label{fig:transferOverfeat}
\end{figure}

%-----------------------------------
%	SECTION 2
%-----------------------------------
\section{M\'etricas de calidad utilizadas}


%-----------------------------------
%	SECTION 3
%-----------------------------------

\section{Resultados obtenidos durante el dise\'no del algoritmo}

%----------------------------------------------------------------------------------------
%	SECTION 4
%----------------------------------------------------------------------------------------

\subsection{Preprocesamiento}
\begin{itemize}
\item Extracci\'on de fondo: El objetivo de esta etapa consiste en suavizar la im\'agen, para esto calculamos el fondo de la misma, luego  restamos a la im\'agen original este fondo y de esta manera podemos remover el efecto de bias causado por la modalidad de captura de la im\'agen. Finalmente se convierte la im\'agen a double para tener mayor precisi\'on en las pr\'oximas etapas.
	\begin{itemize}
		\item Filtro de Mediana: para el calculo del filtro de mediana, se busc\'o cual era la mejor ventana a utilizar para cada uno de los dataset nombrados anteriormente, basandonos en el valor obtenido por la funci\'on vlroc de Matlab que determina el \'area bajo la curva promedio para cada set de im\'agenes. Los resultados arrojaron diferentes valores para cada conjunto de im\'agenes, por un lado se obtuvo un valor de ventana igual a 113 para el dataset HRF, lo cual es razonable para el tama\'no de dichas im\'agenes. Con este valor de ventana se obtuvo un \'area promedio de 0.93549792847311808; Por otro lado, con el conjunto de DRIVE se determin\'o que el mejor valor de ventana es 29, dando un valor de \'area bajo la curva de 0.89402376839923237,  lo cual tambi\'en es razonable ya que este tipo de im\'agenes son de menor tama\~no que las anteriores. Finalmente las im\'agenes ARIA resultaron un valor de ventana igual a 41 con un valor de \'area bajo la curva de 0.87129918114207383.
		
\begin{figure}[H]
\centering
\graphicspath {Figures} 
	  \label{fig:color}}
		\subfloat{\includegraphics[width=0.5\textwidth]{area_mediana_hrf} \label{fig:mediana_hrf}}
		\subfloat{\includegraphics[width=0.5\textwidth]{area_mediana_drive} \label{fig:mediana_drive}}
		\subfloat{\includegraphics[width=1\textwidth]{area_mediana_aria} \label{fig:mediana_aria}}
    \caption{\'Areas promedio para cada tam\~no de ventana. De izquierda a derecha: HRF; DRIVE; ARIA}
		\label{fig:transferOverfeat}
\end{figure}
		\item Filtro Gaussiano: para el calculo de \'area bajo la curva de este filtro, se utilizaron los par\'ametros por defecto del filtro, observ\'andose que los valores obtenidos, fueron muy por debajo de los obtenidos en los otros filtros, citando como  ejemplo que el mejor valor de \'area obtenido fue de 0.6581, dando finalmente un \'area promedio de  0,570545455. Por tal raz\'on se determin\'o que no es un filtro aplicable a este tipo de im\'agenes ya que no genera resultados buenos. 

\begin{figure}[H]
\centering
\graphicspath {Figures} 
	  \label{fig:color}}
		\subfloat{\includegraphics[width=1\textwidth]{area_gaussiano_aria} \label{fig:gaussiano_aria}}
    \caption{\'Area para cada im\'agen del dataset ARIA}
		\label{fig:transferOverfeat}
\end{figure}		
		
		\item Filtro Promedio: para el calculo del filtro promedio, se busc\'o cual era la mejor ventana a utilizar para cada uno de los dataset nombrados anteriormente, basandonos en el valor obtenido por la funci\'on vlroc de Matlab que determina el \'area bajo la curva promedio para cada set de im\'agenes. Los resultados arrojaron diferentes valores para cada conjunto de im\'agenes, por un lado se obtuvo un valor de ventana igual a 85 para el dataset HRF, lo cual es razonable para el tama\'no de dichas im\'agenes. Con este valor de ventana se obtuvo un \'area promedio de 0.91206707786006846. Por otro lado, con el conjunto de DRIVE se determin\'o que el mejor valor de ventana es 25, dando un valor de \'area bajo la curva de 0.86215776453164372,  lo cual tambi\'en es razonable ya que este tipo de im\'agenes es de menor tama\~no que las anteriores. Finalmente las im\'agenes ARIA resultaron un valor de ventana igual a 39 con un valor de \'area bajo la curva de 0.78861591936804754. 
		
\begin{figure}[H]
\centering
\graphicspath {Figures} 
	  \label{fig:color}}
		\subfloat{\includegraphics[width=0.5\textwidth]{area_media_hrf} \label{fig:mediana_hrf}}
		\subfloat{\includegraphics[width=0.5\textwidth]{area_media_drive} \label{fig:mediana_drive}}
		\subfloat{\includegraphics[width=1\textwidth]{area_media_aria} \label{fig:mediana_aria}}
    \caption{\'Areas promedio para cada tam\~no de ventana. De izquierda a derecha: HRF; DRIVE; ARIA}
		\label{fig:transferOverfeat}
\end{figure}
\end{itemize}
\item Extracci\'on de ruido: el objetivo de esta etapa consiste en disminuir el ruido de las im\'agenes que se genera en la captura de fondo de ojo, el cual puede ser generado por el dispositivo de captura utilizado. 
	\begin{itemize}
		\item Filtro anisotr\'opico: en este filtro se busc\'o el valor de la mejor iteraci\'on para cada set de im\'agenes. Los resultados obtenidos para cada set de im\'agenes fueron los siguientes. En el dataset HRF se obtuvo que la mejor iteraci\'on tiene un valor de 16, dando por resultado un \área de 0.93545909045136177. El dataset DRIVE tiene un valor de iteraci\'on para este filtro de 4 y un area de 0.8608094146529679 cuando se aplica con valor de media encontrado anteriormente y un valor de 5 cuando se aplica con el valor de mediana, dando un \'area de 0.90323495204661008. En el dataset ARIA el valor de la mejor iteraci\'on es 8 con un valor de area de 0.88453280013285718.

\begin{figure}[H]
\centering
\graphicspath {Figures} 
	  \label{fig:color}}
		\subfloat{\includegraphics[width=0.5\textwidth]{itera_anisotropica_hrf} \label{fig:anisotropica_hrf}}
		\subfloat{\includegraphics[width=0.5\textwidth]{itera_anisotropica_drive} \label{fig:mediana_drive}}
		\subfloat{\includegraphics[width=1\textwidth]{itera_anisotropica_aria} \label{fig:mediana_aria}}
    \caption{\'Areas promedio para el filtro anisotr\'opico. De izquierda a derecha: HRF; DRIVE; ARIA}
		\label{fig:transferOverfeat}
\end{figure}   
		\item Filtro de coherencia: para este filtro se realiz\'o una b\'usqueda para determinar cu\'al es la iteraci\'on que da el mejor valor de \'area bajo la curva. Para esto se realizaron iteraciones desde 1 hasta 130 en cada conjunto de im\'agenes. Los resultados obtenidos fueron analizados en funci\'on del tiempo computacional que tarda el algoritmo en procesar el conjunto de im\'agenes y el valor de \'area bajo la curva. El n\'umero de iteraciones en el dataset DRIVE que oobtuvo mejor resultado fue la iteraci\'on 75, donde la par\'abola llega al punto m\'aximo dando un \'area de 0.91120933863902276. En el caso del dataset HRF y ARIA, los resultados obtenidos por el filtro de coherencia fueron determinados en base al trade-off planteado antes. En ambos casos, el algoritmo no gener\'o una par\'abola como en el caso de DRIVE, sino que el valor del \'area creci\'o en todo momento. Finalmente se decidi\'o en base que el mejor valor de iteraci\'on quedar\'ia en 50 ya que el tiempo computacional que tarda el algoritmo en iterar hasta 130 en relaci\'on al resultado obtenido no es satisfactorio ya que la variaci\'on en el resultado se ve reci\'en en el tercer d\'igito decimal. El \'area bajo la curva en el dataset HRF con 50 iteraciones es 0.943776025051246 y un tiempo aproximado de 5 horas, mientras que para 130 iteraciones obtenemos un valor de \'area bajo  la curva de 0.94819116836674155 a un tiempo aproximado de 24 horas. Debido a que la relacion tiempo-ganancia es muy grande, se determin\'o que la mejor iteraci\'on en este conjunto de im\'agenes es 50.

\begin{figure}[H]
\centering
\graphicspath {Figures} 
	  \label{fig:color}}
		\subfloat{\includegraphics[width=0.5\textwidth]{itera_anisotropica_hrf} \label{fig:anisotropica_hrf}}
		\subfloat{\includegraphics[width=0.5\textwidth]{itera_anisotropica_drive} \label{fig:mediana_drive}}
		\subfloat{\includegraphics[width=1\textwidth]{itera_anisotropica_aria} \label{fig:mediana_aria}}
    \caption{NO SON LAS IMAGENES QUE VAN. De izquierda a derecha: HRF; DRIVE; ARIA}
		\label{fig:transferOverfeat}
\end{figure}  
		
	\end{itemize}
\end{itemize}


Los resultados obtenidos en los diferentes pipeline se muestran a continuaci\'on.


\begin{table}[H]
\begin{center}
\begin{tabular}{|l|l|l|l|}
\hline
Pipeline & \'Area HRF & \'Area DRIVE & \'Area ARIA \\
\hline \hline
1 & 0.943776025051246 & 0.17466860201317333 & 0.864926317715817 \\ \hline
2 & 0.17466860201317333 & 0.21162654260222666 & 0.3203105756103905 \\ \hline
3 & 0.93599954357138937 & 0.89698004054930147 & 0.87376408859019272 \\ \hline
4 & 0.94664138888216243 & 0.92281496665852036 & 0.88479933279751022 \\ \hline
\end{tabular}
\caption{\'Areas bajo la curva obtenidas en cada pipeline.}
\label{tabla:sencilla}
\end{center}
\end{table}
 

%----------------------------------------------------------------------------------------
%	SUBSECTION 5
%----------------------------------------------------------------------------------------

\subsection{Extracci\'on de caracter\'isticas}


%----------------------------------------------------------------------------------------
%	SECTION 5
%----------------------------------------------------------------------------------------

\subsection{Entrenamiento y clasificaci\'on}

\section{Resultado del algoritmo de segmentaci\'on propuesto}

\section{Discusi\'on}

